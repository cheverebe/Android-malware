.class public final Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;
.super Ljava/lang/Object;
.source "PersonalizationRequest.java"


# annotations
.annotation system Ldalvik/annotation/MemberClasses;
    value = {
        Lcom/touchtype_fluency/service/personalize/PersonalizationRequest$PollRunnable;,
        Lcom/touchtype_fluency/service/personalize/PersonalizationRequest$DownloadRunnable;
    }
.end annotation


# static fields
.field private static final LOOPER_TRY_COUNT:I = 0x5

.field private static TAG:Ljava/lang/String;

.field private static delays:[I


# instance fields
.field private m_apiHelper:Lcom/touchtype_fluency/service/personalize/ApiHelper;

.field private m_apiKey:Ljava/lang/String;

.field private m_context:Landroid/content/Context;

.field private m_downloadPath:Ljava/lang/String;

.field private m_handler:Landroid/os/Handler;

.field private m_listener:Lcom/touchtype_fluency/service/personalize/PersonalizationListener;

.field private m_params:Ljava/lang/String;

.field private m_pollCount:I

.field private m_poller:Ljava/lang/Thread;

.field private m_urlManager:Lcom/touchtype_fluency/service/personalize/UrlManager;


# direct methods
.method static constructor <clinit>()V
    .locals 1

    .prologue
    .line 35
    const-string v0, "PersonalizationRequest"

    sput-object v0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->TAG:Ljava/lang/String;

    .line 374
    const/16 v0, 0x20

    new-array v0, v0, [I

    fill-array-data v0, :array_0

    sput-object v0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->delays:[I

    return-void

    :array_0
    .array-data 0x4
        0x2t 0x0t 0x0t 0x0t
        0x2t 0x0t 0x0t 0x0t
        0x2t 0x0t 0x0t 0x0t
        0x2t 0x0t 0x0t 0x0t
        0x4t 0x0t 0x0t 0x0t
        0x4t 0x0t 0x0t 0x0t
        0x4t 0x0t 0x0t 0x0t
        0x4t 0x0t 0x0t 0x0t
        0x8t 0x0t 0x0t 0x0t
        0x8t 0x0t 0x0t 0x0t
        0x8t 0x0t 0x0t 0x0t
        0x8t 0x0t 0x0t 0x0t
        0x10t 0x0t 0x0t 0x0t
        0x10t 0x0t 0x0t 0x0t
        0x10t 0x0t 0x0t 0x0t
        0x10t 0x0t 0x0t 0x0t
        0x1et 0x0t 0x0t 0x0t
        0x1et 0x0t 0x0t 0x0t
        0x1et 0x0t 0x0t 0x0t
        0x1et 0x0t 0x0t 0x0t
        0x3ct 0x0t 0x0t 0x0t
        0x3ct 0x0t 0x0t 0x0t
        0x3ct 0x0t 0x0t 0x0t
        0x3ct 0x0t 0x0t 0x0t
        0x78t 0x0t 0x0t 0x0t
        0x78t 0x0t 0x0t 0x0t
        0x78t 0x0t 0x0t 0x0t
        0x78t 0x0t 0x0t 0x0t
        0xf0t 0x0t 0x0t 0x0t
        0xf0t 0x0t 0x0t 0x0t
        0xf0t 0x0t 0x0t 0x0t
        0xf0t 0x0t 0x0t 0x0t
    .end array-data
.end method

.method public constructor <init>(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;Lcom/touchtype_fluency/service/personalize/PersonalizationListener;Landroid/content/Context;Lcom/touchtype_fluency/service/personalize/ApiHelper;)V
    .locals 2
    .parameter "installationId"
    .parameter "servicePath"
    .parameter "params"
    .parameter "downloadPath"
    .parameter "listener"
    .parameter "context"
    .parameter "apiHelper"

    .prologue
    .line 43
    invoke-direct {p0}, Ljava/lang/Object;-><init>()V

    .line 386
    const/4 v0, 0x0

    iput v0, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_pollCount:I

    .line 388
    const-string v0, "846c1d3fe45af4cca95ebf41c67198477b29cd86"

    iput-object v0, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_apiKey:Ljava/lang/String;

    .line 44
    new-instance v0, Lcom/touchtype_fluency/service/personalize/UrlManager;

    invoke-direct {v0, p1, p2, p6}, Lcom/touchtype_fluency/service/personalize/UrlManager;-><init>(Ljava/lang/String;Ljava/lang/String;Landroid/content/Context;)V

    iput-object v0, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_urlManager:Lcom/touchtype_fluency/service/personalize/UrlManager;

    .line 45
    iput-object p3, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_params:Ljava/lang/String;

    .line 46
    iput-object p5, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_listener:Lcom/touchtype_fluency/service/personalize/PersonalizationListener;

    .line 47
    iput-object p4, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_downloadPath:Ljava/lang/String;

    .line 48
    iput-object p6, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_context:Landroid/content/Context;

    .line 49
    iput-object p7, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_apiHelper:Lcom/touchtype_fluency/service/personalize/ApiHelper;

    .line 50
    iget-object v0, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_context:Landroid/content/Context;

    invoke-virtual {v0}, Landroid/content/Context;->getResources()Landroid/content/res/Resources;

    move-result-object v0

    const v1, 0x7f0b000c

    invoke-virtual {v0, v1}, Landroid/content/res/Resources;->getString(I)Ljava/lang/String;

    move-result-object v0

    iput-object v0, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_apiKey:Ljava/lang/String;

    .line 51
    return-void
.end method

.method static synthetic access$000()Ljava/lang/String;
    .locals 1

    .prologue
    .line 34
    sget-object v0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->TAG:Ljava/lang/String;

    return-object v0
.end method

.method static synthetic access$100(Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;)Landroid/content/Context;
    .locals 1
    .parameter "x0"

    .prologue
    .line 34
    iget-object v0, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_context:Landroid/content/Context;

    return-object v0
.end method

.method static synthetic access$1000(Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;)I
    .locals 1
    .parameter "x0"

    .prologue
    .line 34
    iget v0, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_pollCount:I

    return v0
.end method

.method static synthetic access$1008(Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;)I
    .locals 2
    .parameter "x0"

    .prologue
    .line 34
    iget v0, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_pollCount:I

    add-int/lit8 v1, v0, 0x1

    iput v1, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_pollCount:I

    return v0
.end method

.method static synthetic access$1100(Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;)V
    .locals 0
    .parameter "x0"
    .annotation system Ldalvik/annotation/Throws;
        value = {
            Ljava/io/IOException;,
            Lcom/touchtype_fluency/service/personalize/ServerBusyException;,
            Lcom/touchtype_fluency/service/personalize/ServerApiException;
        }
    .end annotation

    .prologue
    .line 34
    invoke-direct {p0}, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->makeInitialRequest()V

    return-void
.end method

.method static synthetic access$200(Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;)Lcom/touchtype_fluency/service/personalize/ApiHelper;
    .locals 1
    .parameter "x0"

    .prologue
    .line 34
    iget-object v0, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_apiHelper:Lcom/touchtype_fluency/service/personalize/ApiHelper;

    return-object v0
.end method

.method static synthetic access$300(Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;)Ljava/lang/String;
    .locals 1
    .parameter "x0"

    .prologue
    .line 34
    iget-object v0, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_downloadPath:Ljava/lang/String;

    return-object v0
.end method

.method static synthetic access$400(Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;)Lcom/touchtype_fluency/service/personalize/UrlManager;
    .locals 1
    .parameter "x0"

    .prologue
    .line 34
    iget-object v0, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_urlManager:Lcom/touchtype_fluency/service/personalize/UrlManager;

    return-object v0
.end method

.method static synthetic access$500(Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;)Lcom/touchtype_fluency/service/personalize/PersonalizationListener;
    .locals 1
    .parameter "x0"

    .prologue
    .line 34
    iget-object v0, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_listener:Lcom/touchtype_fluency/service/personalize/PersonalizationListener;

    return-object v0
.end method

.method static synthetic access$600()[I
    .locals 1

    .prologue
    .line 34
    sget-object v0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->delays:[I

    return-object v0
.end method

.method static synthetic access$700(Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;)Landroid/os/Handler;
    .locals 1
    .parameter "x0"

    .prologue
    .line 34
    iget-object v0, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_handler:Landroid/os/Handler;

    return-object v0
.end method

.method static synthetic access$702(Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;Landroid/os/Handler;)Landroid/os/Handler;
    .locals 0
    .parameter "x0"
    .parameter "x1"

    .prologue
    .line 34
    iput-object p1, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_handler:Landroid/os/Handler;

    return-object p1
.end method

.method static synthetic access$900(Ljava/net/URL;)Ljava/net/URL;
    .locals 1
    .parameter "x0"

    .prologue
    .line 34
    invoke-static {p0}, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->addRandToUrl(Ljava/net/URL;)Ljava/net/URL;

    move-result-object v0

    return-object v0
.end method

.method private addAuthToParams(Ljava/lang/String;)Ljava/lang/String;
    .locals 7
    .parameter "params"

    .prologue
    .line 327
    :try_start_0
    const-string v4, "SHA-1"

    invoke-static {v4}, Ljava/security/MessageDigest;->getInstance(Ljava/lang/String;)Ljava/security/MessageDigest;

    move-result-object v4

    .line 328
    new-instance v5, Ljava/lang/StringBuilder;

    invoke-direct {v5}, Ljava/lang/StringBuilder;-><init>()V

    iget-object v6, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_apiKey:Ljava/lang/String;

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    move-result-object v5

    const-string v6, "-"

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    move-result-object v5

    iget-object v6, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_urlManager:Lcom/touchtype_fluency/service/personalize/UrlManager;

    invoke-virtual {v6}, Lcom/touchtype_fluency/service/personalize/UrlManager;->getGUID()Ljava/lang/String;

    move-result-object v6

    invoke-virtual {v5, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    move-result-object v5

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v5}, Ljava/lang/String;->getBytes()[B

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/security/MessageDigest;->digest([B)[B
    :try_end_0
    .catch Ljava/security/NoSuchAlgorithmException; {:try_start_0 .. :try_end_0} :catch_0

    move-result-object v0

    .line 334
    .local v0, authValue:[B
    new-instance v2, Ljava/lang/StringBuffer;

    invoke-direct {v2}, Ljava/lang/StringBuffer;-><init>()V

    .line 335
    .local v2, hexString:Ljava/lang/StringBuffer;
    const/4 v3, 0x0

    .local v3, i:I
    :goto_0
    array-length v4, v0

    if-ge v3, v4, :cond_1

    .line 336
    aget-byte v4, v0, v3

    and-int/lit16 v4, v4, 0xff

    invoke-static {v4}, Ljava/lang/Integer;->toHexString(I)Ljava/lang/String;

    move-result-object v1

    .line 337
    .local v1, hex:Ljava/lang/String;
    invoke-virtual {v1}, Ljava/lang/String;->length()I

    move-result v4

    const/4 v5, 0x1

    if-ne v4, v5, :cond_0

    .line 338
    const/16 v4, 0x30

    invoke-virtual {v2, v4}, Ljava/lang/StringBuffer;->append(C)Ljava/lang/StringBuffer;

    .line 340
    :cond_0
    invoke-virtual {v2, v1}, Ljava/lang/StringBuffer;->append(Ljava/lang/String;)Ljava/lang/StringBuffer;

    .line 335
    add-int/lit8 v3, v3, 0x1

    goto :goto_0

    .line 330
    .end local v0           #authValue:[B
    .end local v1           #hex:Ljava/lang/String;
    .end local v2           #hexString:Ljava/lang/StringBuffer;
    .end local v3           #i:I
    :catch_0
    move-exception v4

    sget-object v4, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->TAG:Ljava/lang/String;

    const-string v5, "No SHA-1 algorithm found"

    invoke-static {v4, v5}, Lcom/touchtype_fluency/service/LogUtil;->e(Ljava/lang/String;Ljava/lang/String;)V

    .line 343
    .end local p1
    :goto_1
    return-object p1

    .restart local v0       #authValue:[B
    .restart local v2       #hexString:Ljava/lang/StringBuffer;
    .restart local v3       #i:I
    .restart local p1
    :cond_1
    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    invoke-virtual {v4, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    move-result-object v4

    const-string v5, "&auth="

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    move-result-object v4

    invoke-virtual {v2}, Ljava/lang/StringBuffer;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    move-result-object v4

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object p1

    goto :goto_1
.end method

.method private static addRandToUrl(Ljava/net/URL;)Ljava/net/URL;
    .locals 6
    .parameter "url"

    .prologue
    .line 358
    invoke-virtual {p0}, Ljava/net/URL;->toString()Ljava/lang/String;

    move-result-object v3

    const-string v4, "?"

    invoke-virtual {v3, v4}, Ljava/lang/String;->contains(Ljava/lang/CharSequence;)Z

    move-result v3

    .line 359
    if-eqz v3, :cond_0

    const-string v2, "&"

    .line 361
    .local v2, separator:Ljava/lang/String;
    :goto_0
    new-instance v0, Ljava/util/Random;

    invoke-direct {v0}, Ljava/util/Random;-><init>()V

    .line 362
    .local v0, r:Ljava/util/Random;
    new-instance v3, Ljava/lang/StringBuilder;

    const-string v4, "rand="

    invoke-direct {v3, v4}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V

    const v4, 0x98967f

    invoke-virtual {v0, v4}, Ljava/util/Random;->nextInt(I)I

    move-result v4

    invoke-virtual {v3, v4}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    move-result-object v3

    invoke-virtual {v3}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v1

    .line 365
    .local v1, randomPart:Ljava/lang/String;
    :try_start_0
    new-instance v3, Ljava/net/URL;

    new-instance v4, Ljava/lang/StringBuilder;

    invoke-direct {v4}, Ljava/lang/StringBuilder;-><init>()V

    invoke-virtual {p0}, Ljava/net/URL;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    move-result-object v4

    invoke-virtual {v4, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    move-result-object v4

    invoke-virtual {v4, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    move-result-object v4

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v4

    invoke-direct {v3, v4}, Ljava/net/URL;-><init>(Ljava/lang/String;)V
    :try_end_0
    .catchall {:try_start_0 .. :try_end_0} :catchall_0
    .catch Ljava/net/MalformedURLException; {:try_start_0 .. :try_end_0} :catch_0

    .line 370
    :goto_1
    return-object v3

    .line 359
    .end local v0           #r:Ljava/util/Random;
    .end local v1           #randomPart:Ljava/lang/String;
    .end local v2           #separator:Ljava/lang/String;
    :cond_0
    const-string v2, "?"

    goto :goto_0

    .line 367
    .restart local v0       #r:Ljava/util/Random;
    .restart local v1       #randomPart:Ljava/lang/String;
    .restart local v2       #separator:Ljava/lang/String;
    :catch_0
    move-exception v3

    const/4 v3, 0x0

    :try_start_1
    invoke-static {v3}, Ljunit/framework/Assert;->assertTrue(Z)V
    :try_end_1
    .catchall {:try_start_1 .. :try_end_1} :catchall_0

    .line 370
    const/4 v3, 0x0

    goto :goto_1

    .line 368
    :catchall_0
    move-exception v3

    throw v3
.end method

.method private addTextRetentionToParams(Ljava/lang/String;)Ljava/lang/String;
    .locals 3
    .parameter "params"

    .prologue
    .line 351
    new-instance v0, Ljava/lang/StringBuilder;

    invoke-direct {v0}, Ljava/lang/StringBuilder;-><init>()V

    invoke-virtual {v0, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    move-result-object v0

    const-string v1, "&retain_text="

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    move-result-object v0

    iget-object v1, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_context:Landroid/content/Context;

    invoke-virtual {v1}, Landroid/content/Context;->getResources()Landroid/content/res/Resources;

    move-result-object v1

    const v2, 0x7f080029

    invoke-virtual {v1, v2}, Landroid/content/res/Resources;->getBoolean(I)Z

    move-result v1

    invoke-virtual {v0, v1}, Ljava/lang/StringBuilder;->append(Z)Ljava/lang/StringBuilder;

    move-result-object v0

    invoke-virtual {v0}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    return-object v0
.end method

.method private makeInitialRequest()V
    .locals 7
    .annotation system Ldalvik/annotation/Throws;
        value = {
            Ljava/io/IOException;,
            Lcom/touchtype_fluency/service/personalize/ServerBusyException;,
            Lcom/touchtype_fluency/service/personalize/ServerApiException;
        }
    .end annotation

    .prologue
    .line 282
    iget-object v4, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_urlManager:Lcom/touchtype_fluency/service/personalize/UrlManager;

    invoke-virtual {v4}, Lcom/touchtype_fluency/service/personalize/UrlManager;->getInitialUrl()Ljava/net/URL;

    move-result-object v4

    invoke-virtual {v4}, Ljava/net/URL;->openConnection()Ljava/net/URLConnection;

    move-result-object v1

    check-cast v1, Ljavax/net/ssl/HttpsURLConnection;

    .line 284
    .local v1, httpsConn:Ljavax/net/ssl/HttpsURLConnection;
    invoke-static {}, Lcom/touchtype_fluency/service/personalize/SSLTools;->getTrustAllSocketFactory()Ljavax/net/ssl/SSLSocketFactory;

    move-result-object v4

    invoke-virtual {v1, v4}, Ljavax/net/ssl/HttpsURLConnection;->setSSLSocketFactory(Ljavax/net/ssl/SSLSocketFactory;)V

    .line 285
    sget-object v4, Lcom/touchtype_fluency/service/personalize/SSLTools;->DO_NOT_VERIFY_HOST:Ljavax/net/ssl/HostnameVerifier;

    invoke-virtual {v1, v4}, Ljavax/net/ssl/HttpsURLConnection;->setHostnameVerifier(Ljavax/net/ssl/HostnameVerifier;)V

    .line 286
    const/4 v4, 0x0

    invoke-virtual {v1, v4}, Ljavax/net/ssl/HttpsURLConnection;->setInstanceFollowRedirects(Z)V

    .line 287
    const-string v4, "POST"

    invoke-virtual {v1, v4}, Ljavax/net/ssl/HttpsURLConnection;->setRequestMethod(Ljava/lang/String;)V

    .line 288
    const/4 v4, 0x1

    invoke-virtual {v1, v4}, Ljavax/net/ssl/HttpsURLConnection;->setDoOutput(Z)V

    .line 290
    iget-object v4, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_params:Ljava/lang/String;

    invoke-direct {p0, v4}, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->addTextRetentionToParams(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v4

    iput-object v4, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_params:Ljava/lang/String;

    .line 291
    iget-object v4, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_params:Ljava/lang/String;

    invoke-direct {p0, v4}, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->addAuthToParams(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v4

    iput-object v4, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_params:Ljava/lang/String;

    .line 292
    sget-object v4, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->TAG:Ljava/lang/String;

    new-instance v4, Ljava/lang/StringBuilder;

    const-string v5, "Querying URL "

    invoke-direct {v4, v5}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V

    iget-object v5, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_urlManager:Lcom/touchtype_fluency/service/personalize/UrlManager;

    invoke-virtual {v5}, Lcom/touchtype_fluency/service/personalize/UrlManager;->getInitialUrl()Ljava/net/URL;

    move-result-object v5

    invoke-virtual {v5}, Ljava/net/URL;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    move-result-object v4

    const-string v5, " with params "

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    move-result-object v4

    iget-object v5, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_params:Ljava/lang/String;

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    move-result-object v4

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    .line 293
    new-instance v3, Ljava/io/OutputStreamWriter;

    invoke-virtual {v1}, Ljavax/net/ssl/HttpsURLConnection;->getOutputStream()Ljava/io/OutputStream;

    move-result-object v4

    invoke-direct {v3, v4}, Ljava/io/OutputStreamWriter;-><init>(Ljava/io/OutputStream;)V

    .line 295
    .local v3, wr:Ljava/io/OutputStreamWriter;
    iget-object v4, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_params:Ljava/lang/String;

    invoke-virtual {v3, v4}, Ljava/io/OutputStreamWriter;->write(Ljava/lang/String;)V

    .line 296
    invoke-virtual {v3}, Ljava/io/OutputStreamWriter;->close()V

    .line 298
    invoke-virtual {v1}, Ljavax/net/ssl/HttpsURLConnection;->getResponseCode()I

    move-result v2

    .line 299
    .local v2, response:I
    sget-object v4, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->TAG:Ljava/lang/String;

    new-instance v4, Ljava/lang/StringBuilder;

    const-string v5, "makeInitialRequest: got response "

    invoke-direct {v4, v5}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V

    invoke-virtual {v4, v2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    move-result-object v4

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    .line 301
    sparse-switch v2, :sswitch_data_0

    .line 317
    new-instance v4, Lcom/touchtype_fluency/service/personalize/ServerApiException;

    new-instance v5, Ljava/lang/StringBuilder;

    const-string v6, "Initial request, expected 301 or 503, got "

    invoke-direct {v5, v6}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V

    invoke-virtual {v5, v2}, Ljava/lang/StringBuilder;->append(I)Ljava/lang/StringBuilder;

    move-result-object v5

    invoke-virtual {v5}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v5

    invoke-direct {v4, v5}, Lcom/touchtype_fluency/service/personalize/ServerApiException;-><init>(Ljava/lang/String;)V

    throw v4

    .line 303
    :sswitch_0
    const-string v4, "Location"

    invoke-virtual {v1, v4}, Ljavax/net/ssl/HttpsURLConnection;->getHeaderField(Ljava/lang/String;)Ljava/lang/String;

    move-result-object v0

    .line 305
    .local v0, establishedUrl:Ljava/lang/String;
    const-string v4, "http"

    invoke-virtual {v0, v4}, Ljava/lang/String;->startsWith(Ljava/lang/String;)Z

    move-result v4

    if-eqz v4, :cond_0

    .line 306
    new-instance v4, Ljava/lang/StringBuilder;

    const-string v5, "https"

    invoke-direct {v4, v5}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V

    const/4 v5, 0x4

    invoke-virtual {v0, v5}, Ljava/lang/String;->substring(I)Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    move-result-object v4

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    move-result-object v0

    .line 308
    :cond_0
    iget-object v4, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_urlManager:Lcom/touchtype_fluency/service/personalize/UrlManager;

    invoke-virtual {v4, v0}, Lcom/touchtype_fluency/service/personalize/UrlManager;->setEstablishedUrl(Ljava/lang/String;)V

    .line 309
    sget-object v4, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->TAG:Ljava/lang/String;

    new-instance v4, Ljava/lang/StringBuilder;

    const-string v5, "makeInitialRequest: got server address "

    invoke-direct {v4, v5}, Ljava/lang/StringBuilder;-><init>(Ljava/lang/String;)V

    iget-object v5, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_urlManager:Lcom/touchtype_fluency/service/personalize/UrlManager;

    invoke-virtual {v5}, Lcom/touchtype_fluency/service/personalize/UrlManager;->getEstablishedUrlString()Ljava/lang/String;

    move-result-object v5

    invoke-virtual {v4, v5}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;

    move-result-object v4

    invoke-virtual {v4}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;

    .line 310
    return-void

    .line 313
    .end local v0           #establishedUrl:Ljava/lang/String;
    :sswitch_1
    sget-object v4, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->TAG:Ljava/lang/String;

    const-string v5, "Servers are returning busy"

    invoke-static {v4, v5}, Lcom/touchtype_fluency/service/LogUtil;->w(Ljava/lang/String;Ljava/lang/String;)V

    .line 314
    new-instance v4, Lcom/touchtype_fluency/service/personalize/ServerBusyException;

    const-string v5, "Servers returned busy"

    invoke-direct {v4, v5}, Lcom/touchtype_fluency/service/personalize/ServerBusyException;-><init>(Ljava/lang/String;)V

    throw v4

    .line 301
    nop

    :sswitch_data_0
    .sparse-switch
        0x12d -> :sswitch_0
        0x1f7 -> :sswitch_1
    .end sparse-switch
.end method


# virtual methods
.method public start()V
    .locals 1

    .prologue
    .line 236
    new-instance v0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest$1;

    invoke-direct {v0, p0}, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest$1;-><init>(Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;)V

    iput-object v0, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_poller:Ljava/lang/Thread;

    .line 274
    iget-object v0, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_poller:Ljava/lang/Thread;

    invoke-virtual {v0}, Ljava/lang/Thread;->start()V

    .line 275
    return-void
.end method

.method public stop()V
    .locals 1

    .prologue
    .line 278
    iget-object v0, p0, Lcom/touchtype_fluency/service/personalize/PersonalizationRequest;->m_poller:Ljava/lang/Thread;

    invoke-virtual {v0}, Ljava/lang/Thread;->interrupt()V

    .line 279
    return-void
.end method
